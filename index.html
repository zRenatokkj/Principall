<!DOCTYPE html> 
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>📂 Visualizador de Arquivos do GitHub + Expo Snack</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <header class="w-full max-w-6xl text-center mb-6">
    <h1 class="text-3xl font-bold">📂 Arquivos do GitHub + 📱 Expo Snack</h1>
  </header>

  <main class="w-full max-w-6xl bg-white shadow rounded-xl p-6">

    <!-- Filtro -->
    <section class="mb-6 flex flex-wrap gap-4 items-center">
      <span class="font-semibold">Exibir tipos:</span>
      <label class="flex items-center gap-1"><input type="checkbox" value=".html" onchange="applyFilter()" checked>HTML</label>
      <label class="flex items-center gap-1"><input type="checkbox" value=".js" onchange="applyFilter()" checked>JS</label>
      <label class="flex items-center gap-1"><input type="checkbox" value=".css" onchange="applyFilter()" checked>CSS</label>
      <label class="flex items-center gap-1"><input type="checkbox" value=".py" onchange="applyFilter()" checked>Python</label>
      <label class="flex items-center gap-1"><input type="checkbox" value=".snack" onchange="applyFilter()" checked>Expo Snack</label>
    </section>

    <!-- Saída -->
    <div id="output" class="text-gray-700 w-full max-h-[700px] overflow-auto p-4 border rounded-xl bg-gray-50">
      <div class="flex justify-center py-10">
        <span class="text-gray-500">Carregando repositórios...</span>
      </div>
    </div>
  </main>

  <script>
    const user = "zRenatokkj";

    // Links Expo Snack
    const expoProjects = [
      { name: "📖 Cardápio", url: "https://snack.expo.dev/@renato7/cardapio" },
      { name: "👋 Hello", url: "https://snack.expo.dev/@renato7/hello" },
      { name: "🔄 Conversor", url: "https://snack.expo.dev/@renato7/km-conversor" },
      { name: "💸 Despesas", url: "https://snack.expo.dev/@renato7/despesas-1" },
      { name: "📊 Controle de Abastecimento", url: "https://snack.expo.dev/@renato7/controle" },
      { name: "☕ Cafeteria", url: "https://snack.expo.dev/@renato7/5ac13f?platform=web" },
      { name: "🐶 PetShop", url: "https://petcare-hub-20.preview.emergentagent.com/" },
      { name: "🎶 Playlist", url: "https://snack.expo.dev/@renato7/playlist-" },
      { name: "🚗 Locadora", url: "https://snack.expo.dev/@renato7/ed3b3b" }
    ];

    // Renderiza seção fixa Expo Snack
    function renderExpoSection(output) {
      const container = document.createElement("div");
      container.className = "border border-gray-300 rounded-xl p-4 mb-4 bg-yellow-50";

      const title = document.createElement("h2");
      title.className = "font-bold text-lg text-yellow-800 mb-2";
      title.textContent = "📱 Expo Snack";

      const fileList = document.createElement("ul");
      fileList.className = "ml-4 space-y-1";

      expoProjects.forEach(project => {
        const li = document.createElement("li");
        li.dataset.type = "file";
        li.dataset.ext = ".snack"; // extensão própria para filtro
        li.className = "hover:bg-yellow-100 p-1 rounded-md transition-colors";

        li.innerHTML = `
          📄 <span>${project.name}</span>
          <a href="${project.url}" target="_blank" class="ml-2 px-2 py-0.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded">Abrir</a>
        `;
        fileList.appendChild(li);
      });

      container.appendChild(title);
      container.appendChild(fileList);
      output.appendChild(container);
    }

    // GitHub API
    async function fetchFromGitHub(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Erro ${res.status}`);
      return res.json();
    }

    async function loadRepos() {
      const output = document.getElementById("output");
      output.innerHTML = "";

      // Renderiza Expo Snack primeiro
      renderExpoSection(output);

      try {
        const repos = await fetchFromGitHub(`https://api.github.com/users/${user}/repos`);

        for (const repo of repos) {
          const repoElement = document.createElement("div");
          repoElement.className = "border border-gray-300 rounded-xl p-4 mb-4 bg-white shadow";
          repoElement.innerHTML = `<h2 class="font-bold text-lg text-blue-700 mb-2">📦 ${repo.name}</h2>`;

          const fileList = document.createElement("ul");
          fileList.className = "ml-4 space-y-1";
          repoElement.appendChild(fileList);

          output.appendChild(repoElement);
          await loadFiles(user, repo.name, "", fileList);
        }
        applyFilter();
      } catch (err) {
        output.innerHTML += `<p class="text-red-500">${err.message}</p>`;
      }
    }

    async function loadFiles(user, repo, path, parentElement) {
      try {
        const files = await fetchFromGitHub(`https://api.github.com/repos/${user}/${repo}/contents/${path}`);
        for (const file of files) {
          if (file.type === "dir") {
            const dir = document.createElement("li");
            dir.dataset.type = "dir";
            dir.innerHTML = `📂 <span class="font-semibold">${file.name}</span>`;
            const subList = document.createElement("ul");
            subList.className = "ml-6 border-l pl-3 space-y-1";
            dir.appendChild(subList);
            parentElement.appendChild(dir);
            await loadFiles(user, repo, file.path, subList);
          } else {
            parentElement.appendChild(createFileElement(file, repo));
          }
        }
      } catch (err) {
        console.error(err);
      }
    }

    function createFileElement(file, repo) {
      const ext = file.name.split('.').pop().toLowerCase();
      const li = document.createElement("li");
      li.dataset.type = "file";
      li.dataset.ext = "." + ext;
      li.className = "hover:bg-gray-100 p-1 rounded-md transition-colors";

      let viewButton = "";
      if (ext === "html") {
        const githubPagesURL = `https://${user}.github.io/${repo}/${file.path}`;
        viewButton = `<button onclick="window.open('${githubPagesURL}', '_blank')" class="ml-2 px-2 py-0.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded">Visualizar</button>`;
      }

      li.innerHTML = `
        📄 <span>${file.name}</span>
        <a href="${file.html_url}" target="_blank" class="text-blue-600 hover:underline ml-2">Abrir no GitHub</a>
        ${viewButton}
      `;
      return li;
    }

    // Filtro
    function applyFilter() {
      const selected = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .map(c => c.value.toLowerCase());

      document.querySelectorAll("#output li[data-type='file']").forEach(li => {
        li.style.display = selected.includes(li.dataset.ext) ? "list-item" : "none";
      });

      document.querySelectorAll("#output li[data-type='dir']").forEach(dir => {
        const children = dir.querySelectorAll(":scope > ul > li");
        const hasVisibleChild = Array.from(children).some(c => c.style.display !== "none");
        dir.style.display = hasVisibleChild ? "list-item" : "none";
      });

      document.querySelectorAll("#output > div").forEach(repoDiv => {
        const files = repoDiv.querySelectorAll("li[data-type='file']");
        const hasVisibleFile = Array.from(files).some(file => file.style.display !== "none");
        repoDiv.style.display = hasVisibleFile ? "block" : "none";
      });
    }

    loadRepos();
  </script>

</body>
</html>





