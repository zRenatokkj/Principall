<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>ðŸ“‚ Visualizador de Arquivos do GitHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
</head>

<body class="bg-gradient-to-b from-gray-100 to-gray-200 dark:bg-gradient-to-b dark:from-gray-800 dark:to-gray-900 min-h-screen flex flex-col items-center p-6 transition-colors duration-300">

    <button id="theme-toggle" type="button" class="absolute top-4 right-4 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full p-2 transition-colors duration-300">
        <i id="theme-toggle-dark-icon" class="fas fa-moon w-5 h-5 hidden text-gray-800 dark:text-white"></i>
        <i id="theme-toggle-light-icon" class="fas fa-sun w-5 h-5 hidden text-gray-800 dark:text-white"></i>
    </button>

    <header class="w-full max-w-6xl text-center mb-8">
        <h1 class="text-4xl font-extrabold text-gray-800 dark:text-white flex items-center justify-center gap-2">
            ðŸ“‚ Arquivos do GitHub
        </h1>
    </header>

    <main class="w-full max-w-6xl bg-white dark:bg-gray-800 shadow-2xl rounded-2xl p-8 transition-colors duration-300">

        <section class="mb-6 flex flex-wrap gap-4 items-center">
            <span class="font-semibold text-gray-700 dark:text-gray-300">Exibir tipos:</span>
            <label class="flex items-center gap-1"><input type="checkbox" value=".html" onchange="applyFilter()" checked>
                HTML</label>
            <label class="flex items-center gap-1"><input type="checkbox" value=".js" onchange="applyFilter()" checked>
                JS</label>
            <label class="flex items-center gap-1"><input type="checkbox" value=".css" onchange="applyFilter()" checked>
                CSS</label>
            <label class="flex items-center gap-1"><input type="checkbox" value=".py" onchange="applyFilter()" checked>
                Python</label>
        </section>

        <div id="output" class="text-gray-700 dark:text-gray-300 w-full max-h-[800px] overflow-auto p-4 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
            <div class="flex justify-center py-10">
                <svg class="w-8 h-8 animate-spin text-blue-600 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
                </svg>
                <span class="ml-3 text-gray-500 dark:text-gray-400">Carregando repositÃ³rios...</span>
            </div>
        </div>

    </main>

    <script>
        const user = "zRenatokkj";
        const token = "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";

        // Dark Mode Toggle
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

        // Check if there is a saved theme
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            // Show the light icon and hide the dark icon
            themeToggleLightIcon.classList.remove('hidden');
            themeToggleDarkIcon.classList.add('hidden');
            document.documentElement.classList.add('dark');
        } else {
            // Show the dark icon and hide the light icon
            themeToggleDarkIcon.classList.remove('hidden');
            themeToggleLightIcon.classList.add('hidden');
            document.documentElement.classList.remove('dark');
        }

        themeToggleBtn.addEventListener('click', function() {
            // Toggle icons inside button
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');

            // If is set in localStorage
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }

                // If NOT set in localStorage
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });


        async function fetchFromGitHub(url) {
            const res = await fetch(url, {
                headers: {
                    Authorization: `token ${token}`
                }
            });
            if (!res.ok) throw new Error(`Erro ${res.status}: ${res.statusText}`);
            return res.json();
        }

        async function loadRepos() {
            const output = document.getElementById("output");
            try {
                const repos = await fetchFromGitHub(`https://api.github.com/users/${user}/repos`);
                output.innerHTML = "";

                for (const repo of repos) {
                    const repoElement = createRepoElement(repo.name);
                    output.appendChild(repoElement);
                    await loadFiles(user, repo.name, "", repoElement.querySelector("ul"));
                }
                applyFilter();
            } catch (err) {
                output.innerHTML = `<p class="text-center text-red-500 dark:text-red-400">${err.message}</p>`;
            }
        }

        function createRepoElement(repoName) {
            const container = document.createElement("div");
            container.className = "border border-gray-300 dark:border-gray-700 rounded-xl p-4 mb-4 shadow-sm bg-white dark:bg-gray-800 transition-colors duration-300";

            const title = document.createElement("h2");
            title.className = "font-bold text-lg text-blue-700 dark:text-blue-400 mb-2";
            title.textContent = `ðŸ“¦ ${repoName}`;

            const fileList = document.createElement("ul");
            fileList.className = "ml-4 space-y-1";

            container.appendChild(title);
            container.appendChild(fileList);
            return container;
        }

        async function loadFiles(user, repo, path, parentElement) {
            try {
                const files = await fetchFromGitHub(`https://api.github.com/repos/${user}/${repo}/contents/${path}`);
                for (const file of files) {
                    if (file.type === "dir") {
                        const dir = document.createElement("li");
                        dir.dataset.type = "dir";
                        dir.innerHTML = `ðŸ“‚ <span class="font-semibold text-gray-800 dark:text-gray-200">${file.name}</span>`;
                        const subList = document.createElement("ul");
                        subList.className = "ml-6 border-l border-gray-200 dark:border-gray-700 pl-3 space-y-1";
                        dir.appendChild(subList);
                        parentElement.appendChild(dir);
                        await loadFiles(user, repo, file.path, subList);
                    } else {
                        parentElement.appendChild(createFileElement(file, repo, path));
                    }
                }
            } catch (err) {
                console.error(err);
            }
        }

        function createFileElement(file, repo, path) {
            const ext = file.name.split('.').pop().toLowerCase();
            const li = document.createElement("li");
            li.dataset.type = "file";
            li.dataset.ext = "." + ext;
            li.className = "hover:bg-gray-100 dark:hover:bg-gray-700 p-1 rounded-md transition-colors duration-200"; // Added hover effect

            let viewButton = "";
            if (ext === "html") {
                const githubPagesURL = `https://${user}.github.io/${repo}/${file.path}`;
                viewButton = `<button onclick="window.open('${githubPagesURL}', '_blank')" class="ml-2 px-2 py-0.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded transition-colors duration-200">Visualizar</button>`;
            }

            li.innerHTML = `
        ðŸ“„ <span class="text-gray-800 dark:text-gray-200">${file.name}</span>
        <a href="${file.html_url}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline ml-2">Abrir no GitHub</a>
        ${viewButton}
      `;
            return li;
        }

        function applyFilter() {
            const selected = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(c => c.value.toLowerCase());

            // 1. Filtrar os arquivos:
            document.querySelectorAll("#output li[data-type='file']").forEach(li => {
                li.style.display = selected.includes(li.dataset.ext) ? "list-item" : "none";
            });

            // 2. Ocultar diretÃ³rios vazios (de baixo para cima):
            let changed = true;
            while (changed) {
                changed = false;
                document.querySelectorAll("#output li[data-type='dir']").forEach(dir => {
                    const children = dir.querySelectorAll(":scope > ul > li");
                    const hasVisibleChild = Array.from(children).some(c => c.style.display !== "none");

                    if (!hasVisibleChild) {
                        if (dir.style.display !== "none") {
                            dir.style.display = "none";
                            changed = true;
                        }
                    } else {
                        dir.style.display = "list-item";
                    }
                });
            }

            // 3. Ocultar repositÃ³rios sem arquivos visÃ­veis:
            document.querySelectorAll("#output > div").forEach(repoDiv => {
                const files = repoDiv.querySelectorAll("li[data-type='file']");
                const hasVisibleFile = Array.from(files).some(file => file.style.display !== "none");

                // Ocultar ou mostrar o tÃ­tulo do repositÃ³rio
                const repoTitle = repoDiv.querySelector("h2");
                repoTitle.style.display = hasVisibleFile ? "block" : "none";

                // Ocultar ou mostrar o container do repositÃ³rio
                repoDiv.style.display = hasVisibleFile ? "block" : "none";
            });
        }

        loadRepos();
    </script>

</body>

</html>
